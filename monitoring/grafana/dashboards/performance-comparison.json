{
  "uid": "performance-comparison",
  "title": "REST vs GraphQL - Performance Comparison",
  "tags": ["rest", "graphql", "performance", "comparison"],
  "timezone": "browser",
  "refresh": "5s",
  "time": {"from": "now-15m", "to": "now"},
  "panels": [
    {
      "id": 1,
      "title": "üöÄ RPS (Requests Per Second)",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-rest\"}[30s]))",
          "legendFormat": "REST RPS",
          "refId": "A"
        },
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-graphql\"}[30s]))",
          "legendFormat": "GraphQL RPS",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 3, "fillOpacity": 20, "pointSize": 5}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max", "last"]}}
    },
    {
      "id": 2,
      "title": "‚è±Ô∏è Response Time (p50, p95, p99)",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(locust_response_times_bucket{job=\"locust-rest\"}[30s])) by (le))",
          "legendFormat": "REST p50",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.50, sum(rate(locust_response_times_bucket{job=\"locust-graphql\"}[30s])) by (le))",
          "legendFormat": "GraphQL p50",
          "refId": "B"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(locust_response_times_bucket{job=\"locust-rest\"}[30s])) by (le))",
          "legendFormat": "REST p95",
          "refId": "C"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(locust_response_times_bucket{job=\"locust-graphql\"}[30s])) by (le))",
          "legendFormat": "GraphQL p95",
          "refId": "D"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(locust_response_times_bucket{job=\"locust-rest\"}[30s])) by (le))",
          "legendFormat": "REST p99",
          "refId": "E"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(locust_response_times_bucket{job=\"locust-graphql\"}[30s])) by (le))",
          "legendFormat": "GraphQL p99",
          "refId": "F"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 10}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "id": 3,
      "title": "üë• Active Users",
      "type": "timeseries",
      "gridPos": {"h": 6, "w": 8, "x": 0, "y": 8},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "locust_users{job=\"locust-rest\"}",
          "legendFormat": "REST Users",
          "refId": "A"
        },
        {
          "expr": "locust_users{job=\"locust-graphql\"}",
          "legendFormat": "GraphQL Users",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 30}
        }
      }
    },
    {
      "id": 4,
      "title": "‚ùå Error Rate (%)",
      "type": "timeseries",
      "gridPos": {"h": 6, "w": 8, "x": 8, "y": 8},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-rest\", result=\"failure\"}[1m])) / sum(rate(locust_requests_total{job=\"locust-rest\"}[1m])) * 100",
          "legendFormat": "REST Error %",
          "refId": "A"
        },
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-graphql\", result=\"failure\"}[1m])) / sum(rate(locust_requests_total{job=\"locust-graphql\"}[1m])) * 100",
          "legendFormat": "GraphQL Error %",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "max": 100,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 20},
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green", "value": null},
              {"color": "yellow", "value": 1},
              {"color": "red", "value": 5}
            ]
          }
        }
      }
    },
    {
      "id": 5,
      "title": "üìä Total Requests",
      "type": "stat",
      "gridPos": {"h": 6, "w": 8, "x": 16, "y": 8},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(locust_requests_total{job=\"locust-rest\"})",
          "legendFormat": "REST",
          "refId": "A"
        },
        {
          "expr": "sum(locust_requests_total{job=\"locust-graphql\"})",
          "legendFormat": "GraphQL",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        }
      },
      "options": {"graphMode": "area", "colorMode": "value", "textMode": "auto"}
    },
    {
      "id": 6,
      "title": "üì¶ Data Transferred (Response Size)",
      "type": "timeseries",
      "gridPos": {"h": 7, "w": 12, "x": 0, "y": 14},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(rate(locust_response_length_total{job=\"locust-rest\"}[30s]))",
          "legendFormat": "REST Bytes/sec",
          "refId": "A"
        },
        {
          "expr": "sum(rate(locust_response_length_total{job=\"locust-graphql\"}[30s]))",
          "legendFormat": "GraphQL Bytes/sec",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "Bps",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 30}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "id": 7,
      "title": "üîÑ Network I/O (Container)",
      "type": "timeseries",
      "gridPos": {"h": 7, "w": 12, "x": 12, "y": 14},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(rate(container_network_transmit_bytes_total{name=~\"rest-.*|nginx-gateway\"}[1m]))",
          "legendFormat": "REST TX",
          "refId": "A"
        },
        {
          "expr": "sum(rate(container_network_transmit_bytes_total{name=~\"graphql-.*|apollo-router\"}[1m]))",
          "legendFormat": "GraphQL TX",
          "refId": "B"
        },
        {
          "expr": "sum(rate(container_network_receive_bytes_total{name=~\"rest-.*|nginx-gateway\"}[1m]))",
          "legendFormat": "REST RX",
          "refId": "C"
        },
        {
          "expr": "sum(rate(container_network_receive_bytes_total{name=~\"graphql-.*|apollo-router\"}[1m]))",
          "legendFormat": "GraphQL RX",
          "refId": "D"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "Bps",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 20}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "id": 8,
      "title": "üíª CPU Usage",
      "type": "timeseries",
      "gridPos": {"h": 7, "w": 12, "x": 0, "y": 21},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(rate(container_cpu_usage_seconds_total{name=~\"rest-.*|nginx-gateway\"}[1m])) * 100",
          "legendFormat": "REST CPU %",
          "refId": "A"
        },
        {
          "expr": "sum(rate(container_cpu_usage_seconds_total{name=~\"graphql-.*|apollo-router\"}[1m])) * 100",
          "legendFormat": "GraphQL CPU %",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 3, "fillOpacity": 30}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "id": 9,
      "title": "üß† Memory Usage",
      "type": "timeseries",
      "gridPos": {"h": 7, "w": 12, "x": 12, "y": 21},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(container_memory_usage_bytes{name=~\"rest-.*|nginx-gateway\"}) / 1024 / 1024",
          "legendFormat": "REST Memory (MB)",
          "refId": "A"
        },
        {
          "expr": "sum(container_memory_usage_bytes{name=~\"graphql-.*|apollo-router\"}) / 1024 / 1024",
          "legendFormat": "GraphQL Memory (MB)",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "decmbytes",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 3, "fillOpacity": 30}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "id": 10,
      "title": "‚ö° CPU Efficiency (RPS per CPU %)",
      "type": "timeseries",
      "gridPos": {"h": 7, "w": 12, "x": 0, "y": 28},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-rest\"}[30s])) / (sum(rate(container_cpu_usage_seconds_total{name=~\"rest-.*|nginx-gateway\"}[1m])) * 100 + 0.001)",
          "legendFormat": "REST (RPS/CPU%)",
          "refId": "A"
        },
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-graphql\"}[30s])) / (sum(rate(container_cpu_usage_seconds_total{name=~\"graphql-.*|apollo-router\"}[1m])) * 100 + 0.001)",
          "legendFormat": "GraphQL (RPS/CPU%)",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 20}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "id": 11,
      "title": "üíæ Memory Efficiency (RPS per MB)",
      "type": "timeseries",
      "gridPos": {"h": 7, "w": 12, "x": 12, "y": 28},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-rest\"}[30s])) / (sum(container_memory_usage_bytes{name=~\"rest-.*|nginx-gateway\"}) / 1024 / 1024 + 0.001)",
          "legendFormat": "REST (RPS/MB)",
          "refId": "A"
        },
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-graphql\"}[30s])) / (sum(container_memory_usage_bytes{name=~\"graphql-.*|apollo-router\"}) / 1024 / 1024 + 0.001)",
          "legendFormat": "GraphQL (RPS/MB)",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 20}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "bottom", "calcs": ["mean", "max"]}}
    },
    {
      "id": 12,
      "title": "üìà REST - RPS by Endpoint",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 35},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-rest\"}[30s])) by (name)",
          "legendFormat": "{{name}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 20}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "right", "calcs": ["mean"]}}
    },
    {
      "id": 13,
      "title": "üìà GraphQL - RPS by Endpoint",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 35},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-graphql\"}[30s])) by (name)",
          "legendFormat": "{{name}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 20}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "right", "calcs": ["mean"]}}
    },
    {
      "id": 14,
      "title": "‚è±Ô∏è REST - Response Time by Endpoint (p50)",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 43},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(locust_response_times_bucket{job=\"locust-rest\"}[30s])) by (le, name))",
          "legendFormat": "{{name}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 10}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "right", "calcs": ["mean"]}}
    },
    {
      "id": 15,
      "title": "‚è±Ô∏è GraphQL - Response Time by Endpoint (p50)",
      "type": "timeseries",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 43},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(locust_response_times_bucket{job=\"locust-graphql\"}[30s])) by (le, name))",
          "legendFormat": "{{name}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "min": 0,
          "custom": {"drawStyle": "line", "lineWidth": 2, "fillOpacity": 10}
        }
      },
      "options": {"legend": {"displayMode": "table", "placement": "right", "calcs": ["mean"]}}
    },
    {
      "id": 16,
      "title": "üìä Summary Stats",
      "type": "table",
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 51},
      "datasource": {"type": "prometheus", "uid": "prometheus"},
      "targets": [
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-rest\"}[1m]))",
          "legendFormat": "REST RPS",
          "refId": "A",
          "instant": true
        },
        {
          "expr": "sum(rate(locust_requests_total{job=\"locust-graphql\"}[1m]))",
          "legendFormat": "GraphQL RPS",
          "refId": "B",
          "instant": true
        },
        {
          "expr": "histogram_quantile(0.50, sum(rate(locust_response_times_bucket{job=\"locust-rest\"}[1m])) by (le))",
          "legendFormat": "REST p50 (ms)",
          "refId": "C",
          "instant": true
        },
        {
          "expr": "histogram_quantile(0.50, sum(rate(locust_response_times_bucket{job=\"locust-graphql\"}[1m])) by (le))",
          "legendFormat": "GraphQL p50 (ms)",
          "refId": "D",
          "instant": true
        },
        {
          "expr": "sum(container_memory_usage_bytes{name=~\"rest-.*|nginx-gateway\"}) / 1024 / 1024",
          "legendFormat": "REST Memory (MB)",
          "refId": "E",
          "instant": true
        },
        {
          "expr": "sum(container_memory_usage_bytes{name=~\"graphql-.*|apollo-router\"}) / 1024 / 1024",
          "legendFormat": "GraphQL Memory (MB)",
          "refId": "F",
          "instant": true
        }
      ],
      "transformations": [
        {"id": "merge"},
        {"id": "organize", "options": {"excludeByName": {"Time": true}}}
      ]
    }
  ]
}
