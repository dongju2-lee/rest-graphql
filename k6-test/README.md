# k6 Load Testing

ì •í™•í•œ ìš”ì²­ ìˆ˜ë¡œ GraphQL vs REST ì„±ëŠ¥ì„ ë¹„êµí•˜ëŠ” k6 í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.

## ğŸ¯ íŠ¹ì§•

- âœ… **ì •í™•í•œ ìš”ì²­ ìˆ˜**: 10,000ë²ˆ ì •í™•íˆ ì‹¤í–‰
- âœ… **ë™ì¼í•œ ì¡°ê±´**: GraphQLê³¼ REST ëª¨ë‘ ë™ì¼í•œ VU, ìš”ì²­ ìˆ˜
- âœ… **Prometheus ì—°ë™**: ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- âœ… **Grafana ëŒ€ì‹œë³´ë“œ**: k6 ì „ìš© ì‹œê°í™”
- âœ… **4ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤**: ê°„ë‹¨í•œ ì¿¼ë¦¬ ~ ë³µì¡í•œ ì§‘ê³„

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. Simple Query (40%)
- GraphQL: ë‹¨ì¼ ì¿¼ë¦¬ë¡œ í•„ìš”í•œ í•„ë“œë§Œ
- REST: GET /api/users

### 2. Cross-Service Join (30%)
- GraphQL: Federationìœ¼ë¡œ ìë™ ì¡°ì¸
- REST: 2ë²ˆì˜ API í˜¸ì¶œ í•„ìš”

### 3. N+1 Problem (20%)
- GraphQL: DataLoaderë¡œ ìµœì í™”
- REST: N+1 í˜¸ì¶œ ë°œìƒ

### 4. Complex Aggregation (10%)
- GraphQL: ì¤‘ì²©ëœ ì¿¼ë¦¬ 1ë²ˆ
- REST: ì—¬ëŸ¬ ë²ˆì˜ ìˆœì°¨ í˜¸ì¶œ

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. ì‹œìŠ¤í…œ ì‹œì‘
```bash
# ë¨¼ì € main ì‹œìŠ¤í…œ ì‹œì‘
./scripts/quick-start.sh
```

### 2. k6 í…ŒìŠ¤íŠ¸ ì‹¤í–‰

#### ê¸°ë³¸ ì‹¤í–‰ (50ëª…, 10,000ë²ˆ)
```bash
./scripts/start-k6.sh
```

#### ì»¤ìŠ¤í…€ ì„¤ì •
```bash
# 100ëª…ì˜ ì‚¬ìš©ìë¡œ 20,000ë²ˆ ìš”ì²­
./scripts/start-k6.sh -u 100 -i 20000

# 200ëª…ì˜ ì‚¬ìš©ìë¡œ 50,000ë²ˆ ìš”ì²­, ìµœëŒ€ 30ë¶„
./scripts/start-k6.sh -u 200 -i 50000 -d 30m

# ë„ì›€ë§ ë³´ê¸°
./scripts/start-k6.sh -h
```

**ì˜µì…˜:**
- `-u, --users N`: ê°€ìƒ ì‚¬ìš©ì ìˆ˜ (ê¸°ë³¸: 50)
- `-i, --iterations N`: ì´ ìš”ì²­ ìˆ˜ (ê¸°ë³¸: 10000)
- `-d, --duration TIME`: ìµœëŒ€ ì‹¤í–‰ ì‹œê°„ (ê¸°ë³¸: 10m)

### 3. ê²°ê³¼ í™•ì¸
- **Grafana**: http://localhost:33000
  - Dashboard: "k6 Performance Test"
- **Console**: ì‹¤ì‹œê°„ ë¡œê·¸ ì¶œë ¥

### 4. í…ŒìŠ¤íŠ¸ ì¢…ë£Œ
```bash
./scripts/stop-k6.sh
```

## ğŸ“ˆ ê²°ê³¼ ë©”íŠ¸ë¦­

k6ê°€ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•˜ëŠ” ë©”íŠ¸ë¦­:

### HTTP ë©”íŠ¸ë¦­
- `http_reqs`: ì´ ìš”ì²­ ìˆ˜
- `http_req_duration`: ìš”ì²­ ì‘ë‹µ ì‹œê°„ (P50, P95, P99)
- `http_req_failed`: ì‹¤íŒ¨í•œ ìš”ì²­ ë¹„ìœ¨
- `http_req_blocked`: ì—°ê²° ëŒ€ê¸° ì‹œê°„
- `http_req_connecting`: TCP ì—°ê²° ì‹œê°„
- `http_req_sending`: ë°ì´í„° ì „ì†¡ ì‹œê°„
- `http_req_waiting`: TTFB (Time To First Byte)
- `http_req_receiving`: ë°ì´í„° ìˆ˜ì‹  ì‹œê°„

### ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­
- `graphql_requests_total`: GraphQL ìš”ì²­ ìˆ˜
- `graphql_errors_total`: GraphQL ì—ëŸ¬ ìˆ˜
- `graphql_duration_ms`: GraphQL ì‘ë‹µ ì‹œê°„
- `rest_requests_total`: REST ìš”ì²­ ìˆ˜
- `rest_errors_total`: REST ì—ëŸ¬ ìˆ˜
- `rest_duration_ms`: REST ì‘ë‹µ ì‹œê°„

### k6 ë‚´ì¥ ë©”íŠ¸ë¦­
- `vus`: í˜„ì¬ ê°€ìƒ ì‚¬ìš©ì ìˆ˜
- `iterations`: ì™„ë£Œëœ ë°˜ë³µ ìˆ˜
- `data_sent`: ì „ì†¡í•œ ë°ì´í„°ëŸ‰
- `data_received`: ìˆ˜ì‹ í•œ ë°ì´í„°ëŸ‰

## ğŸ”§ ì„¤ì • ë³€ê²½

### ìš”ì²­ ìˆ˜ ë³€ê²½
`k6-graphql.js`, `k6-rest.js` íŒŒì¼ì˜ `options` ìˆ˜ì •:

```javascript
export const options = {
  iterations: 20000,  // 2ë§Œë²ˆìœ¼ë¡œ ë³€ê²½
  vus: 100,           // 100ëª…ìœ¼ë¡œ ë³€ê²½
};
```

### ì„ê³„ê°’ ë³€ê²½
```javascript
thresholds: {
  'http_req_duration': ['p(95)<1000'], // 1ì´ˆë¡œ ì™„í™”
  'http_req_failed': ['rate<0.05'],    // 5%ë¡œ ì™„í™”
},
```

## ğŸ“Š vs Locust

| í•­ëª© | k6 | Locust |
|------|----|----|
| **ìš”ì²­ ìˆ˜** | ì •í™•íˆ ì œì–´ | ì‹œê°„ ê¸°ë°˜ (ë¶€ì •í™•) |
| **ë¹„êµ ê³µì •ì„±** | âœ… ê³µì •í•¨ | âŒ ì†ë„ì— ë”°ë¼ ë‹¤ë¦„ |
| **Prometheus** | ë„¤ì´í‹°ë¸Œ ì§€ì› | í”ŒëŸ¬ê·¸ì¸ í•„ìš” |
| **ì‚¬ìš© ì‚¬ë¡€** | ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ | ë¶€í•˜ í…ŒìŠ¤íŠ¸ |

## ğŸ’¡ Tip

1. **ì •í™•í•œ ë¹„êµ**ë¥¼ ìœ„í•´ k6 ì‚¬ìš© ì¶”ì²œ
2. **ë¶€í•˜ í…ŒìŠ¤íŠ¸**ëŠ” Locust ì‚¬ìš© ì¶”ì²œ
3. ë‘ ë„êµ¬ë¥¼ **ë³‘í–‰** ì‚¬ìš©í•˜ë©´ ë” ì¢‹ìŒ!
